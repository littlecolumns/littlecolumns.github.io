<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.4 Testing our classifier | _main.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="5.4 Testing our classifier | _main.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.4 Testing our classifier | _main.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-our-classifier.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>2</b> Preface</a><ul>
<li class="chapter" data-level="2.0.1" data-path="preface.html"><a href="preface.html#the-original-story"><i class="fa fa-check"></i><b>2.0.1</b> The original story</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-data.html"><a href="the-data.html"><i class="fa fa-check"></i><b>3</b> The Data</a><ul>
<li class="chapter" data-level="3.1" data-path="turning-our-question-into-measureables.html"><a href="turning-our-question-into-measureables.html"><i class="fa fa-check"></i><b>3.1</b> Turning our question into measureables</a></li>
<li class="chapter" data-level="3.2" data-path="data-car-issue-issues.html"><a href="data-car-issue-issues.html"><i class="fa fa-check"></i><b>3.2</b> Data: Car issue issues</a></li>
<li class="chapter" data-level="3.3" data-path="data-suspicious-airbag-issues.html"><a href="data-suspicious-airbag-issues.html"><i class="fa fa-check"></i><b>3.3</b> Data: Suspicious airbag issues</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-suspicious-airbag-issues.html"><a href="data-suspicious-airbag-issues.html#extracting-a-sample-of-complaints"><i class="fa fa-check"></i><b>3.3.1</b> Extracting a sample of complaints</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-suspicious-airbag-issues.html"><a href="data-suspicious-airbag-issues.html#labeling-our-sample-of-complaints"><i class="fa fa-check"></i><b>3.3.2</b> Labeling our sample of complaints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-our-data.html"><a href="preparing-our-data.html"><i class="fa fa-check"></i><b>4</b> Preparing our data</a><ul>
<li class="chapter" data-level="4.1" data-path="designing-our-features.html"><a href="designing-our-features.html"><i class="fa fa-check"></i><b>4.1</b> Designing our features</a><ul>
<li class="chapter" data-level="4.1.1" data-path="designing-our-features.html"><a href="designing-our-features.html#selecting-our-features"><i class="fa fa-check"></i><b>4.1.1</b> Selecting our features</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>4.2</b> Classification</a><ul>
<li class="chapter" data-level="4.2.1" data-path="classification.html"><a href="classification.html#training-data"><i class="fa fa-check"></i><b>4.2.1</b> Training data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analyzing-our-data.html"><a href="analyzing-our-data.html"><i class="fa fa-check"></i><b>5</b> Analyzing our data</a><ul>
<li class="chapter" data-level="5.1" data-path="building-a-classifier.html"><a href="building-a-classifier.html"><i class="fa fa-check"></i><b>5.1</b> Building a classifier</a></li>
<li class="chapter" data-level="5.2" data-path="interpreting-our-classifier.html"><a href="interpreting-our-classifier.html"><i class="fa fa-check"></i><b>5.2</b> Interpreting our classifier</a></li>
<li class="chapter" data-level="5.3" data-path="using-our-classifier.html"><a href="using-our-classifier.html"><i class="fa fa-check"></i><b>5.3</b> Using our classifier</a></li>
<li class="chapter" data-level="5.4" data-path="testing-our-classifier.html"><a href="testing-our-classifier.html"><i class="fa fa-check"></i><b>5.4</b> Testing our classifier</a><ul>
<li class="chapter" data-level="5.4.1" data-path="testing-our-classifier.html"><a href="testing-our-classifier.html#test-train-split"><i class="fa fa-check"></i><b>5.4.1</b> Test-train split</a></li>
<li class="chapter" data-level="5.4.2" data-path="testing-our-classifier.html"><a href="testing-our-classifier.html#the-confusion-matrix"><i class="fa fa-check"></i><b>5.4.2</b> The confusion matrix</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>5.5</b> Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="testing-our-classifier" class="section level2">
<h2><span class="header-section-number">5.4</span> Testing our classifier</h2>
<p>When we look at the results of our classifier, we know some of them are wrong - complaints shouldn’t be suspicious if they don’t have airbags in them! But it would be nice to have an <strong>automated process</strong> to give us an idea of how well our classifier does.</p>
<p>We test a classifier just like our teachers test us in class: we’ll show our classifier rows we you know the answer to, and see if it gets them right. The problem is <strong>we can’t test it on our unlabeled data, because we doesn’t know what’s right and what’s wrong</strong>. Instead, we have to test on the labeled data we know the answer to.</p>
<p>One technique would be having our classifier compare the actual labels on our training data (suspicious, not suspicious) to what it would predict those labels to be.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="testing-our-classifier.html#cb17-1"></a><span class="co"># Look at our training data, predict the labels,</span></span>
<span id="cb17-2"><a href="testing-our-classifier.html#cb17-2"></a><span class="co"># then compare the labels to the actual labels</span></span>
<span id="cb17-3"><a href="testing-our-classifier.html#cb17-3"></a>clf.score(X, y)</span></code></pre></div>
<pre><code>## 0.9212121212121213</code></pre>
<p>Incredible, 92% accuracy! It got 92% correct! …that’s good, right? <strong>Well, not really.</strong> There are two major reason why this isn’t impressive:</p>
<ul>
<li>We’re testing it on data it’s already seen</li>
<li>The vast majority of our samples are not suspicious</li>
</ul>
<div id="test-train-split" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Test-train split</h3>
<p>The biggest problem with our classifier is that we’re testing it on <strong>data it’s already seen</strong>. While it’s cool to have a study sheet for a quiz, it doesn’t quite seem fair if the <strong>study sheet is exactly the same as the test</strong>.</p>
<p>Instead, we should try to reproduce what the real world is like - training it on one set of data, and testing it on <em>similar</em> data… but similar data we already know the labels for! It’s like how a teacher gives sample quizzes that are similar - but not the same - as the the real one.</p>
<p>To make this happen we use something called <strong>train/test split</strong>, where instead of using the entire dataset for training, we only use most of it - maybe 75% or so. The code on the line below automatically splits the dataset into two groups, one for training and a smaller one for testing.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="testing-our-classifier.html#cb19-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb19-2"><a href="testing-our-classifier.html#cb19-2"></a></span>
<span id="cb19-3"><a href="testing-our-classifier.html#cb19-3"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>)</span></code></pre></div>
<p>That way when we give the model a test, it hasn’t seen the answers already!</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="testing-our-classifier.html#cb20-1"></a>clf.score(X_test, y_test)</span></code></pre></div>
<pre><code>## 0.9285714285714286</code></pre>
<p>Not bad, not bad. There are other ways to improve this further, but for now we have a larger problem to tackle.</p>
</div>
<div id="the-confusion-matrix" class="section level3">
<h3><span class="header-section-number">5.4.2</span> The confusion matrix</h3>
<p>Our accuracy is looking great, hovering somewhere in the 90’s. Feeling good, right? <strong>Unfortunately, things aren’t actually that rosy.</strong></p>
<p>Let’s take a look at how many suspicious and how many non-suspicious complaints we have:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="testing-our-classifier.html#cb22-1"></a>labeled_df.is_suspicious.value_counts()</span></code></pre></div>
<pre><code>## 0.0    150
## 1.0     15
## Name: is_suspicious, dtype: int64</code></pre>
<p>We have a lot more non-suspicious ones as compared to suspicious, right? Let’s say we were classifying, and we <em>always</em> guessed “not suspicious”. Since there are so few suspicious ones, we wouldn’t get very many wrong, and our accuracy would be really high!</p>
<blockquote>
<p>If we have 99 non-suspicious and 1 suspicious, if we always guess “non-suspicious” we’d have 99% accuracy.</p>
</blockquote>
<p>Even though our accuracy would look great, the result would be super boring. Since zero of our complaints would have been marked as suspicious, we wouldn’t have anything to read or research. <strong>It’d be much nicer if we could identify the difference between getting one category right compared to the other.</strong></p>
<p>And hey, that’s easy! We use this thing called a <strong>confusion matrix</strong>. It looks like this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="testing-our-classifier.html#cb24-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb24-2"><a href="testing-our-classifier.html#cb24-2"></a></span>
<span id="cb24-3"><a href="testing-our-classifier.html#cb24-3"></a>y_true <span class="op">=</span> y</span>
<span id="cb24-4"><a href="testing-our-classifier.html#cb24-4"></a>y_pred <span class="op">=</span> clf.predict(X)</span>
<span id="cb24-5"><a href="testing-our-classifier.html#cb24-5"></a></span>
<span id="cb24-6"><a href="testing-our-classifier.html#cb24-6"></a>confusion_matrix(y_true, y_pred)</span></code></pre></div>
<pre><code>## array([[150,   0],
##        [ 13,   2]])</code></pre>
<p>…which is pretty terrible-looking, right? It’s hard as heck to understand! Let’s try to spice it up a little bit and make it a little nicer to read:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="testing-our-classifier.html#cb26-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb26-2"><a href="testing-our-classifier.html#cb26-2"></a></span>
<span id="cb26-3"><a href="testing-our-classifier.html#cb26-3"></a><span class="co"># Save the true label, but also save the predicted label</span></span>
<span id="cb26-4"><a href="testing-our-classifier.html#cb26-4"></a>y_true <span class="op">=</span> y</span>
<span id="cb26-5"><a href="testing-our-classifier.html#cb26-5"></a>y_pred <span class="op">=</span> clf.predict(X)</span>
<span id="cb26-6"><a href="testing-our-classifier.html#cb26-6"></a><span class="co"># We could also use just the test dataset</span></span>
<span id="cb26-7"><a href="testing-our-classifier.html#cb26-7"></a><span class="co"># y_true = y_test</span></span>
<span id="cb26-8"><a href="testing-our-classifier.html#cb26-8"></a><span class="co"># y_pred = clf.predict(X_test)</span></span>
<span id="cb26-9"><a href="testing-our-classifier.html#cb26-9"></a></span>
<span id="cb26-10"><a href="testing-our-classifier.html#cb26-10"></a><span class="co"># Build the confusion matrix</span></span>
<span id="cb26-11"><a href="testing-our-classifier.html#cb26-11"></a>matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb26-12"><a href="testing-our-classifier.html#cb26-12"></a></span>
<span id="cb26-13"><a href="testing-our-classifier.html#cb26-13"></a><span class="co"># But then make it look nice</span></span>
<span id="cb26-14"><a href="testing-our-classifier.html#cb26-14"></a>label_names <span class="op">=</span> pd.Series([<span class="st">&#39;not suspicious&#39;</span>, <span class="st">&#39;suspicious&#39;</span>])</span>
<span id="cb26-15"><a href="testing-our-classifier.html#cb26-15"></a>pd.DataFrame(matrix,</span>
<span id="cb26-16"><a href="testing-our-classifier.html#cb26-16"></a>     columns<span class="op">=</span><span class="st">&#39;Predicted &#39;</span> <span class="op">+</span> label_names,</span>
<span id="cb26-17"><a href="testing-our-classifier.html#cb26-17"></a>     index<span class="op">=</span><span class="st">&#39;Is &#39;</span> <span class="op">+</span> label_names)</span></code></pre></div>
<div class='table-wrapper'>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Predicted not suspicious
</th>
<th style="text-align:right;">
Predicted suspicious
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Is not suspicious
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Is suspicious
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
</div>
<p>So now we can see what’s going on a little bit better. According to the confusion matrix, when using our test set:</p>
<ul>
<li>We correctly predicted 38 of 38 not-suspicious</li>
<li>We only correctly predicted 2 of 4 suspicious ones.</li>
</ul>
<p>Not nearly as good as we’d hoped.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-our-classifier.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>

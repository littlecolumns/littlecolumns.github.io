<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <title>Car Crashes - Feature selection and engineering</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans:400,700&display=swap" rel="stylesheet"> -->
  <link rel="stylesheet" href="/ds4j/css/spectre.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-exp.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-icons.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/ds4j/css/style.css" rel="stylesheet">
  <link href="/ds4j/css/highlight.css" rel="stylesheet">
</head>

<body>
  <div class="nav-holder bg-secondary">
  <div class='content'>
    <header class="navbar">
      <section class="navbar-section">
        <a href="/ds4j/" class="navbar-brand mr-2">DS4J</a>
      </section>
      <section class="navbar-section">
        <a href="/ds4j/projects" class="btn btn-link">Projects</a>
        <a href="/ds4j/topics" class="btn btn-link">Topics</a>
        <a href="/ds4j/curriculum" class="btn btn-link">Curriculum</a>
        <a href="/ds4j/about" class="btn btn-link">About</a>
      </section>
    </header>
  </div>
</div>
  
<div class="content text-based">
  <div class="columns">
    <div class="column col-12 notebook">
      <ul class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Projects</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/car-crashes-weight-regression/">Analyzing whether larger cars cause more deadly crashes</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/car-crashes-weight-regression/car-crashes-feature-selection-and-engineering">Car Crashes - Feature selection and engineering</a>
        </li>
      </ul>

      <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-selection-and-feature-engineering">Feature selection and feature engineering<a class="anchor-link" href="#Feature-selection-and-feature-engineering">#</a></h1><p>This isn't based on a news article, exactly, it's from a paper. You can see the paper in <code>/data/</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="reading-options">
  <a class="btn" href="/ds4j/car-crashes-weight-regression/car-crashes-feature-selection-and-engineering">
    <i class="fa fa-sm fa-book"></i>
    Read online
  </a>
  <a class="btn" href="/ds4j/car-crashes-weight-regression/notebooks/Car Crashes - Feature selection and engineering.ipynb">
    <i class="fa fa-sm fa-download"></i>
    Download notebook
  </a>
  <a class="btn" href="#">
    <i class="fa fa-sm fa-laptop"></i>
    Interactive version
  </a>
</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Reading-in-our-data">Reading in our data<a class="anchor-link" href="#Reading-in-our-data">#</a></h1><h2 id="Every-single-person-in-a-crash">Every single person in a crash<a class="anchor-link" href="#Every-single-person-in-a-crash">#</a></h2><p>We'll start by reading in the list of people who were involved in an accident.</p>
<p><strong>Call this dataframe <code>people</code>.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How often did each severity of injury show up? (e.g. not injured, non-incapacitating injury, etc)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We're only interested in fatalities, so let's create a new <code>had_fatality</code> column for when people received a fatal injury.</p>
<p><strong>Confirm there were 1681 people with fatal injuries.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Working-on-Features">Working on Features<a class="anchor-link" href="#Working-on-Features">#</a></h2><h3 id="Starting-our-analysis">Starting our analysis<a class="anchor-link" href="#Starting-our-analysis">#</a></h3><p>We're going to run a regression on the impact of being <strong>male vs female on crash fatalities</strong>. Prepare a dataframe called <code>train_df</code> with the appropriate information in it.</p>
<ul>
<li><strong>Tip:</strong> What column(s) are your input, and what is your output? Aka independent and dependent variables</li>
<li><strong>Tip:</strong> You'll need to convert your input column into something numeric, I suggest using <code>.replace</code></li>
<li><strong>Tip:</strong> We aren't interested in the "Unknown" sex - either filtering or <code>np.nan</code> + <code>.dropna()</code> might be useful ways to get rid of those columns</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm that your <code>train_df</code> has two columns and 815,827 rows.</p>
<blockquote><p><strong>Tip:</strong> If you have more rows, make sure you dropped all of the rows with Unknown sex.</p>
<p><strong>Tip:</strong> If you have more columns, make sure you only have your input and output columns.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Run-your-regression">Run your regression<a class="anchor-link" href="#Run-your-regression">#</a></h3><p>See the effect of sex on whether the person's injuries are fatal or not. After we train the regression, we can use my ✨favorite technique✨ to display features and their odds ratios:</p>
<div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">feature_names</span><span class="p">,</span>
    <span class="s1">&#39;coefficient (log odds ratio)&#39;</span><span class="p">:</span> <span class="n">coefficients</span><span class="p">,</span>
    <span class="s1">&#39;odds ratio&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;odds ratio&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-words-to-interpret-this-result">Use words to interpret this result<a class="anchor-link" href="#Use-words-to-interpret-this-result">#</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-more-features">Adding more features<a class="anchor-link" href="#Adding-more-features">#</a></h2><p>The actual crash data has more details - whether it was snowy/icy, whether it was a highway, etc.</p>
<p>Read in <code>combined-crash-data.csv</code>, calling it <strong><code>crashes</code></strong>, and merge it with our people dataset. I'll save you a lookup: the <code>REPORT_NO</code> is what matches between the two.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Examining-more-possible-features">Examining more possible features<a class="anchor-link" href="#Examining-more-possible-features">#</a></h3><p>How often was it wet, dry, snowy, icy, etc? <strong>What was the most common surfce condition?</strong></p>
<ul>
<li><strong>Tip:</strong> We're interested in surface condition, <em>not</em> road condition, <em>not</em> weather condition</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Do you feel that a <strong>Dry</strong> road condition should be the average of <strong>Wet</strong> and <strong>Snow?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The answer to that should be <em>no</em>, which means we can't use this data as numeric data. We want a different coefficient for each of these - I want to know the impact of dry, the impact of wet, the impact of snow, all separately.</p>
<p>Start by <strong>replacing each code with a proper description.</strong> I'll even include them here:</p>
<ul>
<li><code>00</code> - Not Applicable</li>
<li><code>01</code>  - Wet</li>
<li><code>02</code>  - Dry</li>
<li><code>03</code>  - Snow</li>
<li><code>04</code>  - Ice</li>
<li><code>05</code>  - Mud, Dirt, Gravel</li>
<li><code>06</code>  - Slush</li>
<li><code>07</code>  - Water (standing/moving)</li>
<li><code>08</code>  - Sand</li>
<li><code>09</code>  - Oil</li>
<li><code>88</code>  - Other</li>
<li><code>99</code>  - Unknown</li>
</ul>
<p>But watch out, pandas read the column in as numbers so they might have come through a little differently than their codes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm you have 147,803 wet, and a few codes you can't understand, like <code>6.03</code> and <code>7.01</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Replace the codes you don't understand with <code>Other</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm you have 3,196 'Other'.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="One-hot-encoding">One-hot encoding<a class="anchor-link" href="#One-hot-encoding">#</a></h2><p>We're going to use <code>pd.get_dummies</code> to build a variable you'll call <code>surf_dummies</code>. Each surface condition should be a <code>0</code> or <code>1</code> as to whether it was that condition (dry, icy, wet, etc).</p>
<p>Use a <code>prefix=</code> so we know they are <strong>surface</strong> conditions.</p>
<p>You'll want to drop the column you'll use as the reference category.</p>
<p><strong>Before we do this: which column works best as the reference?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now build your <code>surf_dummies</code> variable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm your <code>surf_dummies</code> looks roughly like this:</p>
<table>
<thead><tr>
<th>surface_Ice</th>
<th>Surce_Mud, Dirt, Gravel</th>
<th>surface_Not Applicable</th>
<th>...</th>
<th>surface_Wet</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Another-regression">Another regression<a class="anchor-link" href="#Another-regression">#</a></h2><p>Let's run another regression to see the impact of both <strong>sex and surface condition</strong> on fatalities.</p>
<h3 id="Build-your-train_df">Build your <code>train_df</code><a class="anchor-link" href="#Build-your-train_df">#</a></h3><p>To build your <code>train_df</code>, I recommend doing it either of these two ways. They both first select the important columns, then add in the one-hot encoded <code>surf_dummies</code> columns.</p>
<div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span>
    <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">col2</span><span class="p">,</span>
    <span class="s1">&#39;col3&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">col3</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">surf_dummies</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<p>or like this:</p>
<div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span><span class="s1">&#39;col2&#39;</span><span class="p">,</span><span class="s1">&#39;col3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">surf_dummies</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<p>The second one is shorter, but the first one makes it easier to use comments to remove columns later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Run-your-regression-and-check-your-odds-ratios">Run your regression and check your odds ratios<a class="anchor-link" href="#Run-your-regression-and-check-your-odds-ratios">#</a></h3><p>Actually no, wait, first - what kind of surface do you think will have the <strong>highest fatality rate?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm your <code>train_df</code> has 815,843 rows and 9 columns.</p>
<ul>
<li><strong>Tip:</strong> When you run your regression, if you get an error about not knowing what to do with <code>U</code>, it's because you didn't convert your sex to numbers (or if you did, you didn't do it in your original dataframe)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Is this what you expected?</strong> Why do you think this result might be the case?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="More-features:-Vehicles">More features: Vehicles<a class="anchor-link" href="#More-features:-Vehicles">#</a></h1><p>Maybe the car they're in is related to the car they were in. Luckily, we have this information - <strong>read in <code>combined_vehicle_data</code> as <code>vehicles</code>.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Weights-of-those-cars">Weights of those cars<a class="anchor-link" href="#Weights-of-those-cars">#</a></h2><p>The car weights are stored in <strong>another file</strong> since the info had to come from an API. I looked up the VINs - vehicle identification numbers - in a government database to try to get data for each of them.</p>
<p><strong>Read them and build a new dataframe that is both the vehicle data along with their weights.</strong> You can call it <code>vehicles</code> since you don't need the original weightless vehicle data any more.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm that your combined <code>vehicles</code> dataset should have 534,436 rows and 35 columns. And yes, that's less than we were working with before - you haven't combined it with the people/crashes dataset yet.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Filter-your-data">Filter your data<a class="anchor-link" href="#Filter-your-data">#</a></h3><p>We only want vehicles that are "normal" - somewhere between 1500 and 6000 pounds. Filter your vehicles to only include those in that weight range.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm that you have 532,370 vehicles in the dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Add-this-vehicle-information-to-your-merged-data">Add this vehicle information to your merged data<a class="anchor-link" href="#Add-this-vehicle-information-to-your-merged-data">#</a></h2><p>Now we'll have a dataframe that contains information on:</p>
<ul>
<li>The people themselves and their injuries</li>
<li>The crash</li>
<li>The vehicles</li>
</ul>
<p>Every person came with a <code>VEHICLE_ID</code> column that is the vehicle they were in. You'll want to merge on that.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm you have 99 columns and 616,212 rows. <strong>That is a lot of possible features!</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Another-regression,-because-we-can't-get-enough">Another regression, because we can't get enough<a class="anchor-link" href="#Another-regression,-because-we-can't-get-enough">#</a></h2><p>Build another <code>train_df</code> and run another regression about <strong>how car weight impacts the chance of fatalities</strong>. You'll want to confirm that your dataset has 616,212 and 2 columns.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Can you translate that into plain English?</strong> Remember weight is in <strong>pounds</strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I feel like pounds isn't the best measure for something like this. Remember how we had to adjust percentages with AP and life expecntancy, and then change around the way we said things? It sounded like this:</p>
<blockquote><p>Every 10% increase in unemployment translates to a year and a half loss of life expectancy</p>
</blockquote>
<p>Instead of every single pound, maybe we could do every... some other number of pounds? One hundred? One thousand?</p>
<p><strong>Run another regression with weight in thousands of pounds.</strong> Get another odds ratio. Give me another sentence English.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Every thousand pounds heavier your car is increase translates to a 15% decrease in fatalities</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Two-car-accidents,-struck-and-striker">Two-car accidents, struck and striker<a class="anchor-link" href="#Two-car-accidents,-struck-and-striker">#</a></h1><p>Here's the thing, though: <strong>it isn't just the weight of your car.</strong> It's the weight of both cars! If I'm in a big car and I have a wreck with a smaller car, it's the smaller car that's in trouble.</p>
<p>To get that value, we need to do some <strong>feature engineering</strong>, some calculating of <em>new</em> variables from our <em>existing</em> variables.</p>
<p>We need to jump through some hoops to do that.</p>
<h2 id="Two-car-accidents">Two-car accidents<a class="anchor-link" href="#Two-car-accidents">#</a></h2><p>First we're going to count how many vehicles were in each accident. Since we're looking to compare the weight of two cars hitting each other, <strong>we're only going to want crashes with only two cars.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">counted</span> <span class="o">=</span> <span class="n">vehicles</span><span class="o">.</span><span class="n">REPORT_NO</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">counted</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By using <code>.value_counts</code> I can see how many cars were in each crash, and now I'm going to filter to get a list of all of the ones with two vehicles.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">two_car_report_nos</span> <span class="o">=</span> <span class="n">counted</span><span class="p">[</span><span class="n">counted</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">two_car_report_nos</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And now we'll filter my vehicles so we only have those that were in two-vehicle crashes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vehicles</span> <span class="o">=</span> <span class="n">vehicles</span><span class="p">[</span><span class="n">vehicles</span><span class="o">.</span><span class="n">REPORT_NO</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">two_car_report_nos</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Struck-and-striker">Struck and striker<a class="anchor-link" href="#Struck-and-striker">#</a></h3><p>To do the math correctly, we need both the risk of someone dying in the smaller car <em>and</em> the risk of someone dying in the bigger car. To do this we need to separate our cars into two groups:</p>
<ul>
<li>The 'struck' vehicle: did the person die inside?</li>
<li>The 'striker' vehicle: how much heavier was it than the struck car?</li>
</ul>
<p>But we don't know which car was which, so we have to try out both versions - pretending car A was the striker, then pretending car B was the striker. It's hard to explain, but you can read <code>Pounds That Kill - The External Costs of Vehicle Weight.pdf</code> for more details on how it works.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cars_1</span> <span class="o">=</span> <span class="n">vehicles</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;REPORT_NO&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">cars_2</span> <span class="o">=</span> <span class="n">vehicles</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;REPORT_NO&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cars_merged_1</span> <span class="o">=</span> <span class="n">cars_1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cars_2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;REPORT_NO&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_striker&#39;</span><span class="p">,</span> <span class="s1">&#39;_struck&#39;</span><span class="p">])</span>
<span class="n">cars_merged_2</span> <span class="o">=</span> <span class="n">cars_2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cars_1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;REPORT_NO&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_striker&#39;</span><span class="p">,</span> <span class="s1">&#39;_struck&#39;</span><span class="p">])</span>
<span class="n">vehicles_complete</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cars_merged_1</span><span class="p">,</span> <span class="n">cars_merged_2</span><span class="p">])</span>
<span class="n">vehicles_complete</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Put-people-in-their-cars">Put people in their cars<a class="anchor-link" href="#Put-people-in-their-cars">#</a></h2><p>Which car was each person in? We'll assign that now.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vehicles_complete</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;VEHICLE_ID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;VEHICLE_ID_struck&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Add-the-crash-details">Add the crash details<a class="anchor-link" href="#Add-the-crash-details">#</a></h1><p>You did this already! I'm going to do it for you. We're merging on <code>REPORT_NO_x</code> because there are so many <code>REPORT_NO</code> columns duplicated across our files that pandas started giving them weird names.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">crashes</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;REPORT_NO_x&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;REPORT_NO&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Filter">Filter<a class="anchor-link" href="#Filter">#</a></h2><p>We already filtered out vehicles by weight, so we don't have to do that again.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Calculated-features">Calculated features<a class="anchor-link" href="#Calculated-features">#</a></h1><p>I'm sure you forgot what all the features are, so we'll bring back whether there was a fatality or not</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature:-Accident-was-fatal">Feature: Accident was fatal<a class="anchor-link" href="#Feature:-Accident-was-fatal">#</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;had_fatality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">INJ_SEVER_CODE</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">had_fatality</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature:-Weight-difference">Feature: Weight difference<a class="anchor-link" href="#Feature:-Weight-difference">#</a></h2><p><strong>Remove everything missing weights for strikers or struck vehicles.</strong> You might need to <code>merged.columns</code> to remind yourself what the column names are.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Confirm your dataset has roughly 335,000 rows.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create a new feature called <code>weight_diff</code> about how much heavier the striking car was compared to the struck car. <strong>Make sure you've done the math correctly!</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Feature-adjustment">Feature adjustment<a class="anchor-link" href="#Feature-adjustment">#</a></h3><p>Make all of your weight columns in <strong>thousands of pounds</strong> instead of just in pounds. It'll help you interpret your results much better.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Another-regression!!!">Another regression!!!<a class="anchor-link" href="#Another-regression!!!">#</a></h1><p><strong>What is the impact of weight difference on fatality rate?</strong> Create your <code>train_df</code>, drop missing values, run your regression, analyze your odds ratios.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Please translate your odds ratio into plain English.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-in-more-features">Adding in more features<a class="anchor-link" href="#Adding-in-more-features">#</a></h2><p>How about speed limit? That's important, right? We can add the speed limit of the striking vehicle with <code>SPEED_LIMIT_striker</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Can you translate the speed limit odds ratio into plain English?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Feature-engineering:-Speed-limits">Feature engineering: Speed limits<a class="anchor-link" href="#Feature-engineering:-Speed-limits">#</a></h3><p>Honestly, that's a pretty bad way to go about things. What's more fun is if we <strong>translate speed limits into bins.</strong></p>
<p>First, we'll use <code>pd.cut</code> to assign each speed limit a category.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">speed_bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;speed_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">SPEED_LIMIT_struck</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">speed_bins</span><span class="p">)</span>
<span class="n">merged</span><span class="p">[[</span><span class="s1">&#39;SPEED_LIMIT_striker&#39;</span><span class="p">,</span> <span class="s1">&#39;speed_bin&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we'll one-hot encode around 20-30mph speed limits.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">speed_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">speed_bin</span><span class="p">,</span> 
                               <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;speed&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;speed_(20.0, 30.0]&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">speed_dummies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Running-a-regression">Running a regression<a class="anchor-link" href="#Running-a-regression">#</a></h2><p>I like this layout for creating <code>train_df</code>, it allows us to easily add dummies and do a little replacing/encoding when we're building binary features like for sex.</p>
<blockquote><p>If the below gives you an error, it's because <code>SEX_CODE</code> is already a number. In that case, just remove <code>.replace({'M': 1, 'F': 0, 'U': np.nan })</code>.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Start with our normal features</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;weight_diff&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">weight_diff</span><span class="p">,</span>
    <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">SEX_CODE</span><span class="p">,</span><span class="c1">#.replace({&#39;M&#39;: 1, &#39;F&#39;: 0, &#39;U&#39;: np.nan }),</span>
    <span class="s1">&#39;had_fatality&#39;</span><span class="p">:</span> <span class="n">merged</span><span class="o">.</span><span class="n">had_fatality</span><span class="p">,</span>
<span class="p">})</span>
<span class="c1"># Add the one-hot encoded features</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">speed_dummies</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">surf_dummies</span><span class="p">)</span>
<span class="c1"># Drop missing values</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Describe the impact of the different variables in simple language. What has the largest impact?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Now-you-pick-the-features">Now you pick the features<a class="anchor-link" href="#Now-you-pick-the-features">#</a></h2><p>Up above you have examples of:</p>
<ul>
<li>Creating features from numbers (speed limits)</li>
<li>Creating features from 0/1 (sex)</li>
<li>Creating features from binning numbers that are one-hot encoded (speed limit bins - <code>speed_bins</code>)</li>
<li>Creating features from categories that are one-hot encoded (surface - <code>surf_dummies</code></li>
</ul>
<p>What else do you think matters? Try to plug in more features and see if you can get anything interesting.</p>
<blockquote><ul>
<li><strong>Hot tip:</strong> The funniest/most interesting thing feature you can add is also the dumbest. Ask me about it in #algorithms if you end up getting down here.</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
 


    </div>
  </div>
</div>

<script>
  [...document.querySelectorAll(".code_cell")].filter(cell => cell.innerText.trim().length === 0).forEach(cell => cell.remove())
</script>

  <div class="footer bg-secondary">
  <div class="content">
    <div class="columns">
      <div class="column col-6 col-sm-12">
        <p><strong>Hi, welcome to Data Science for Journalism!</strong></p>
        <p>There's been a lot of buzz about machine learning and "artificial intelligence" being used in stories over
          the past few years. It's mostly not that complicated - a little stats, a classifier here or there - but it's
          hard to know where to start without a little help.</p>
        <p>Hopefully this site can be that help! <a href="/ds4j/about">Learn more about this project here.</a></p>
      </div>
      <div class="column col-3 col-sm-6">
        <p><strong>Quick links</strong></p>
        <!-- <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p> -->
      </div>
      <div class="column col-3 col-sm6">
        <p><strong>Contact</strong></p>
        <p><a href="mailto:hello@littlecolumns.com">hello@littlecolumns.com</a></p>
      </div>
    </div>
  </div>
</div>
  <script src="/ds4j/js/tocbot.js"></script>

  <script>
    try {
      let toc = document.createElement("div")
      toc.setAttribute('class', 'js-toc')
      document.querySelector(".reading-options").parentNode.appendChild(toc)
    } catch (err) {

    }

    // Chapter TOC
    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '.js-toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '.notebook',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3, h4',
      activeLinkClass: 'active',
      listClass: 'nav',
      listItemClass: 'nav-item',
      headingLabelCallback: function (label) {
        return label.replace("#", "")
      }
    });
  </script>

</body>

</html>
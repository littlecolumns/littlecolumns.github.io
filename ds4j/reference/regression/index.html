<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8"/>
<title>Regression</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet"/>
<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans:400,700&display=swap" rel="stylesheet"> -->
<link href="/ds4j/css/spectre.min.css" rel="stylesheet"/>
<link href="/ds4j/css/spectre-exp.min.css" rel="stylesheet"/>
<link href="/ds4j/css/spectre-icons.min.css" rel="stylesheet"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="/ds4j/css/style.css" rel="stylesheet"/>
<link href="/ds4j/css/highlight.css" rel="stylesheet"/>
</head>
<body>
<div class="nav-holder bg-secondary">
<div class="content">
<header class="navbar">
<section class="navbar-section">
<a class="navbar-brand mr-2" href="/ds4j/">DS4J</a>
</section>
<section class="navbar-section">
<a class="btn btn-link" href="/ds4j/projects">Projects</a>
<a class="btn btn-link" href="/ds4j/topics">Topics</a>
<a class="btn btn-link" href="/ds4j/curriculum">Curriculum</a>
<a class="btn btn-link" href="/ds4j/about">About</a>
</section>
</header>
</div>
</div>
<div class="columns col-gapless">
<div class="column col-auto bg-dark col-sm-12">
<div class="sidebar-holder">
<div class="accordion-container">
<div class="accordion">
<input checked="checked" hidden="" id="accordion-text-analysis" name="docs-accordion-checkbox" type="checkbox"/>
<a class="accordion-header c-hand" for="accordion-text-analysis" href="/ds4j/reference/text-analysis/">Text Analysis</a>
<div class="accordion-body ref-nav-text-analysis">
</div>
<input hidden="" id="accordion-regression" name="docs-accordion-checkbox" type="checkbox"/>
<a class="accordion-header c-hand" for="accordion-regression" href="/ds4j/reference/regression/">Regression</a>
<div class="accordion-body ref-nav-regression">
</div>
<input hidden="" id="accordion-classification" name="docs-accordion-checkbox" type="checkbox"/>
<a class="accordion-header c-hand" for="accordion-classification" href="/ds4j/reference/classification/">Classification</a>
<div class="accordion-body ref-nav-classification">
</div>
</div>
</div>
</div>
</div>
<div class="column with-sidebar col-sm-12">
<div class="hero">
<div class="hero-body">
<div class="content">
<h1>Regression</h1>
</div>
</div>
</div>
<section class="section">
<div class="content" id="page-content"><html><body><div class="ref-holder"><h2 id="linear-regression">Linear Regression</h2><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-formulas">Using formulas</h3>

<p>We're using <a href="statsmodels.org">statsmodels</a> to perform our regression. They have a nice formula-based method that looks a lot like R.</p>
<p>Here we're using a basketball players' height and weight to predict the number of points scored, using ordinary least-squares regression. <a href="https://patsy.readthedocs.io/en/latest/formulas.html">There's a lot more detail on formulas here</a>.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># regression for points as relates to height and weight</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">'points ~ height + weight'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-dataframes">Using dataframes</h3>

<p>To perform a regression using a whole dataframe, you need two variables:</p>
<ul>
<li><code>X</code> - your features/inputs</li>
<li><code>y</code> - the outputs you're predicting</li>
</ul>
<p>Drop the column you're predicting when creating <code>X</code>, and then save that column as <code>y</code>. You probably want <code>sm.add_constant</code> unless your output is zero when all your inputs are zero.</p>
<p>I almost never use the dataframe version, the formula version (see above) is much nicer.</p>
<p>In this case, <code>df</code> is a dataframe with columns <code>height</code>, <code>weight</code> and <code>points</code>. You're predicting <code>points</code> using <code>height</code> and <code>weight</code>.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="c1"># predicting points using all other columns</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'points'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">points</span>

<span class="c1"># add_constant is automatic in the formula version</span>
<span class="c1"># but for dataframes we need to do it manually</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="predictions-residuals">Predictions residuals</h3>

<p>The residual or error is the difference between the actual value and the predicted value. After you've fit a model, you can just pull the residual from <code>results.resid</code> and send it right back into your dataframe.</p>
<p>In this case you'll get the number of points above or below the predicted score. If someone scored 12 points but it was predicted that they'd score 14, the residual would be -2.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># regression for points as relates to height and weight</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">'points ~ height + weight'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># store residual in new column of original dataframe</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'residual'</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">resid</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="error-standard-deviation">Error standard deviation</h3>

<p>Instead of judging the residual by its raw amount, it might be useful to see how many standard deviations away from the mean it is. That's useful for finding rows that performed much better or worse than predicted.</p>
<p>If someone scored 12 points but it was predicted that they'd score 14, the residual would be -2, but it might be -0.5 standard deviations from the mean. If you're interesting in finding cheaters, you might look for people with an error over 3 standard deviations.</p>

</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">'points ~ height + weight'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># store residual standard deviation in</span>
<span class="c1"># new column of original dataframe</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'error_std_dev'</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">resid</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">mse_resid</span><span class="p">)</span>
</pre></div></div>
</div>
</body></html><h2 id="logistic-regression">Logistic Regression</h2><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-formulas_1">Using formulas</h3>

<p>Use an applicant's SAT score and GPA to predict acceptance to a college. <a href="https://patsy.readthedocs.io/en/latest/formulas.html">There's a lot more detail on formulas here</a>.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># regression for acceptance as relates to SAT score and gpa</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="s1">'acceptance ~ sat_score + gpa'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-dataframes_1">Using dataframes</h3>

<p>To perform a regression using a whole dataframe, you drop the column you're predicting when creating <code>X</code> (your features), and then save that column as <code>y</code> (predicted value). You probably want <code>sm.add_constant</code> unless your output is zero when all your inputs are zero.</p>
<p>I've given up on the dataframe version for the formula version, it's much nicer.</p>
<p>In this case, <code>df</code> is a dataframe with columns <code>sat_score</code>, <code>gpa</code> and <code>acceptance</code>. You're predicting <code>acceptance</code> using <code>sat_score</code> and <code>gpa</code>.</p>

</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="c1"># predicting acceptance using all other columns</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'acceptance'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">points</span>

<span class="c1"># add_constant is automatic in the formula version</span>
<span class="c1"># but for dataframes we need to do it manually</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><h2 id="formula-tricks">Formula tricks</h2><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-categories">Using categories</h3>

<p>Find what role height, weight, and position play in determining how many points a player will score. The <code>position</code> column will be treated as a category, with each position being judged separately.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
  <span class="s1">'points ~ height + weight + C(position)'</span><span class="p">,</span> 
  <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="using-categories-reference">Using categories + reference</h3>

<p>The <code>position</code> column will be treated as a category, with each position being judged separately. By providing a reference category, each other position will be judged <strong>in relation to that category</strong>. For example, "Centers score twice as many points as point guards."</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
  <span class="s1">'points ~ height + weight + C(position, "Point Guard")'</span><span class="p">,</span> 
  <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html><html><body><div class="columns">
<div class="column col-5 col-sm-12 ref-expl"><h3 id="math-calculations">Math calculations</h3>

<p>If <code>height</code> were in inches and we'd prefer to see feet in our regression, we can use <code>np.div</code> to divide height by 12. No need to create a new column!</p>
<p>We can also convert weight to be in increments of 10 pounds instead of single pounds. This is useful in situations like using median income as an input: a single dollar probably has little effect, but you can easily  <code>np.div(income, 10000)</code> to look at $10,000 increases.</p>
</div>
<div class="column col-7 col-sm-12 ref-code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span>
  <span class="s1">'points ~ np.div(height, 12) + np.div(weight, 10)'</span><span class="p">,</span> 
  <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div></div>
</div>
</body></html></div></body></html>

</div>
</section>
<script>
    let refNavSelector = ".ref-nav-regression"
</script>
</div>
</div>
<div class="footer bg-secondary">
<div class="content">
<div class="columns">
<div class="column col-6 col-sm-12">
<p><strong>Hi, welcome to Data Science for Journalism!</strong></p>
<p>There's been a lot of buzz about machine learning and "artificial intelligence" being used in stories over
          the past few years. It's mostly not that complicated - a little stats, a classifier here or there - but it's
          hard to know where to start without a little help.</p>
<p>Hopefully this site can be that help! <a href="/ds4j/about">Learn more about this project here.</a></p>
</div>
<div class="column col-3 col-sm-6">
<p><strong>Quick links</strong></p>
<!-- <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p> -->
</div>
<div class="column col-3 col-sm6">
<p><strong>Contact</strong></p>
<p><a href="mailto:hello@littlecolumns.com">hello@littlecolumns.com</a></p>
</div>
</div>
</div>
</div>
<script src="/ds4j/js/tocbot.js"></script>
<script>
    try {
      let toc = document.createElement("div")
      toc.setAttribute('class', 'js-toc')
      document.querySelector(".reading-options").parentNode.appendChild(toc)
    } catch (err) {

    }

    // Sidebar TOC
    tocbot.init({
      // Where to render the table of contents.
      tocSelector: refNavSelector,
      // Where to grab the headings to build the table of contents.
      contentSelector: '.ref-holder',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3, h4',
      activeLinkClass: 'active',
      listClass: 'menu menu-nav',
      listItemClass: 'menu-item'
    });
    document.querySelector(refNavSelector).previousElementSibling.setAttribute('href', '#')
  </script>
</body>
</html>
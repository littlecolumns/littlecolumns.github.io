<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <title>06-Search for model legislation in over one million bills using Postgres and Solr</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans:400,700&display=swap" rel="stylesheet"> -->
  <link rel="stylesheet" href="/ds4j/css/spectre.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-exp.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-icons.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/ds4j/css/style.css" rel="stylesheet">
  <link href="/ds4j/css/highlight.css" rel="stylesheet">
</head>

<body>
  <div class="nav-holder bg-secondary">
  <div class='content'>
    <header class="navbar">
      <section class="navbar-section">
        <a href="/ds4j/" class="navbar-brand mr-2">DS4J</a>
      </section>
      <section class="navbar-section">
        <a href="/ds4j/projects" class="btn btn-link">Projects</a>
        <a href="/ds4j/topics" class="btn btn-link">Topics</a>
        <a href="/ds4j/curriculum" class="btn btn-link">Curriculum</a>
        <a href="/ds4j/about" class="btn btn-link">About</a>
      </section>
    </header>
  </div>
</div>
  
<div class="content text-based">
  <div class="columns">
    <div class="column col-12 notebook">
      <ul class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Projects</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/azcentral-text-reuse-model-legislation/">Detecting special interest model legislation in state laws</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/azcentral-text-reuse-model-legislation/06-search-for-model-legislation-in-over-one-million-bills-using-postgres-and-solr">06-Search for model legislation in over one million bills using Postgres and Solr</a>
        </li>
      </ul>

      <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Comparing-1.2-million-bills-to-thousands-of-pieces-of-model-legislation">Comparing 1.2 million bills to thousands of pieces of model legislation<a class="anchor-link" href="#Comparing-1.2-million-bills-to-thousands-of-pieces-of-model-legislation">#</a></h1><p>In our mission to reproduce <a href="https://www.usatoday.com/pages/interactives/asbestos-sharia-law-model-bills-lobbyists-special-interests-influence-state-laws/">this piece on model legislation</a>, we need to find all examples of "cut and paste" legislation in our database.</p>
<p>Our previous approach found one piece of model legislation at a time, while this time we'll be looking to process all of them in one batch.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="reading-options">
  <a class="btn" href="/ds4j/azcentral-text-reuse-model-legislation/06-search-for-model-legislation-in-over-one-million-bills-using-postgres-and-solr">
    <i class="fa fa-sm fa-book"></i>
    Read online
  </a>
  <a class="btn" href="/ds4j/azcentral-text-reuse-model-legislation/notebooks/06-Search for model legislation in over one million bills using Postgres and Solr.ipynb">
    <i class="fa fa-sm fa-download"></i>
    Download notebook
  </a>
  <a class="btn" href="#">
    <i class="fa fa-sm fa-laptop"></i>
    Interactive version
  </a>
</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pysolr</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">tqdm</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Read-in-model-bills">Read in model bills<a class="anchor-link" href="#Read-in-model-bills">#</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/alec-model-policies.csv&quot;</span><span class="p">)</span>
<span class="n">model_df</span> <span class="o">=</span> <span class="n">model_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;content&#39;</span><span class="p">})</span>
<span class="n">model_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>url</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Resolution Supporting Congressional Approval of the United States-Mexico-Canada Agreement (USMCA)</td>
      <td>https://www.alec.org/model-policy/resolution-supporting-congressional-approval-of-the-united-states-mexico-canada-agreement-usmca/</td>
      <td>\n\nDraft\nResolution Supporting Congressional Approval of the United States-Mexico-Canada Agreement (USMCA)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWhereas, the imposition of artificial barriers to free and open trade are harmful to American economic interests; and\nWhereas, together, the United States, Canada and Mexico promote a shared belief in freedom, representative democracy and market principles as recognized in the U.S. Constitution; and\nWhereas, a longstanding, close tri-lateral relationship, codified in the North American Free Trade Agreement (NAFTA), has existed between the United States, Canada, and Mexico for more than 25 years and has proven economically, culturally and strategically important for all parties and this relationship will continue with ratification of USMCA; and\nWhereas, trade with Canada and Mexico supports nearly 12 million American jobs, and nearly 5 million of those jobs are supported by increased trade generated by NAFTA and these benefits will co...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Resolution Supporting the Intellectual Property (IP) Provisions in the United States-Mexico-Canada Agreement (USMCA)</td>
      <td>https://www.alec.org/model-policy/draft-resolution-supporting-the-intellectual-property-ip-provisions-in-the-united-states-mexico-canada-agreement-usmca/</td>
      <td>\n\nDraft\nResolution Supporting the Intellectual Property (IP) Provisions in the United States-Mexico-Canada Agreement (USMCA)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWhereas, the American Legislative Exchange Council (ALEC) policy on free trade acknowledges that, “the imposition of artificial barriers to free and open trade…are deterrents to American economic interests;” and\nWhereas, the United States, Canada and Mexico share a belief in freedom, representative democracy and market principles as recognized in the U.S. Constitution; and\nWhereas, trade among our North American trading partners is made up predominantly of intellectual property (IP)-intensive goods and services that employ millions of Americans in high paying jobs and generate billions of dollars in economic output; and\nWhereas, many of the IP-intensive goods, services and exchanges through which trade is facilitated in the NAFTA bloc did not exist when the agreement was drafted and this situation has resulted in u...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Victims of Communism Memorial Day Resolution</td>
      <td>https://www.alec.org/model-policy/draft-victims-of-communism-memorial-day-resolution/</td>
      <td>\n\nDraft\nVictims of Communism Memorial Day Resolution\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nModel Policy\nWHEREAS, the year 2017 marked 100 years since the Bolshevik Revolution in Russia resulting in the world’s first communist regime under Vladimir Lenin, which led to decades of oppression and violence under communist regimes throughout the world; and\nWHEREAS, based on the philosophy of Karl Marx, communism has proven incompatible with the ideals of liberty, prosperity, and dignity of human life and has given rise to such infamous totalitarian dictators as Joseph Stalin, Mao Zedong, Ho Chi Minh, Pol Pot, Nicolae Ceaușescu, the Castro brothers, and the Kim dynasty; and\nWHEREAS, President Donald Trump declared November 7, 2017 a National Day for the Victims of Communism, condemning communism as a political philosophy “incompatible with liberty, prosperity, and the dignity of human life;” and\nWHEREAS, the bipartisan U.S. Congressional Caucus for the Victims of Communism stated ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Resolution in Support of the Taiwan Travel Act</td>
      <td>https://www.alec.org/model-policy/draft-resolution-in-support-of-the-taiwan-travel-act/</td>
      <td>\n\nDraft\nResolution in Support of the Taiwan Travel Act\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nModel Policy\nWhereas, a longstanding, close bilateral relationship, codified in the Taiwan Relations Act, has existed between the United States and Taiwan and has proven economically, culturally and strategically important to both; and\nWhereas, Taiwan is a robust democracy, significant American trading partner and U.S. ally; and\nWhereas, together, Taiwan and the United States promote a shared belief in freedom, democracy and free market principles; and\nWhereas, Taiwan has consistently ranked among the top 12 U.S. trading partners for more than two decades; and\nWhereas, Taiwan serves as a free market, democratic beacon and protector of the rules-based international order in the region.\nTherefore be it resolved, that ALEC applauds the adoption of the Taiwan Travel Act which will encourage the high-level official to official exchanges facilitated by the Act.\nBe it further resolved, ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Draft Resolution Urging the Presidential Administration and Congress to Support Continued U.S. Participation in the U.S.-Korea Free Trade Agreement (KORUS FTA)</td>
      <td>https://www.alec.org/model-policy/draft-resolution-urging-the-presidential-administration-and-congress-to-support-continued-u-s-participation-in-the-u-s-korea-free-trade-agreement-korus-fta/</td>
      <td>\n\nDraft\nDraft Resolution Urging the Presidential Administration and Congress to Support Continued U.S. Participation in the U.S.-Korea Free Trade Agreement (KORUS FTA)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWHEREAS, the American Legislative Exchange Council (ALEC) policy on free trade acknowledges that “the imposition of artificial barriers to free and open trade…are deterrents to American economic interests;” and\nWHEREAS, KORUS FTA was entered into force on March 15, 2012; and\nWHEREAS, KORUS FTA has been the largest U.S. FTA in more than 16 years and is the highest standard trade framework the U.S. currently has in force; and\nWHEREAS, retaining the KORUS FTA at this time would send a strong signal to U.S. trading partners that America’s historic commitment to free trade and economic liberalization remains strong; and\nWHEREAS, the Republic of Korea is the 15th largest economy in the world; and\nWHEREAS, the Republic of Korea is the United States’ seventh largest export marke...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Find-matches">Find matches<a class="anchor-link" href="#Find-matches">#</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SOLR_RESULTS</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">solr</span> <span class="o">=</span> <span class="n">pysolr</span><span class="o">.</span><span class="n">Solr</span><span class="p">(</span><span class="s1">&#39;http://localhost:8983/solr/legislation&#39;</span><span class="p">,</span> <span class="n">always_commit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost:5432/legislation&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_matches</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="c1"># If there are leftovers from a previous match search, remove them</span>
    <span class="n">solr</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s1">&#39;bill_id:0&#39;</span><span class="p">)</span>
    <span class="c1"># Insert the model legislation to do a MLT search</span>
    <span class="n">solr</span><span class="o">.</span><span class="n">add</span><span class="p">([{</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span> <span class="s1">&#39;bill_id&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}])</span>

    <span class="c1"># What&#39;s like the one we just added?</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;http://localhost:8983/solr/legislation/mlt?q=bill_id:0&amp;rows=</span><span class="si">{SOLR_RESULTS}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c1"># Extract bill ids, pass to postgres database</span>
    <span class="n">bill_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;bill_id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;docs&#39;</span><span class="p">]]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from bills where bill_id = ANY(ARRAY</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bill_ids</span><span class="p">)</span>
    <span class="n">matches_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>

    <span class="c1"># Vectorize original and compare to search results</span>
    <span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="n">target</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]])</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">matches_df</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># Count up matches</span>
    <span class="n">sums</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Delete the model legislation that we&#39;re done</span>
    <span class="n">solr</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s1">&#39;bill_id:0&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;matches&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sums</span><span class="p">)),</span>
        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">matches_df</span><span class="o">.</span><span class="n">state_code</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">matches_df</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span>
        <span class="s1">&#39;matched_with&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We can use iterrows because the speed of this part is really not that important</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model_df</span> <span class="o">=</span> <span class="n">model_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm_notebook</span><span class="p">(</span><span class="n">model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="n">model_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">find_matches</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>    
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




 
 
<div id="cee02a11-4632-43f7-82cf-ddac09bf2932"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#cee02a11-4632-43f7-82cf-ddac09bf2932');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ce130262842146558da28b3655a3f6aa", "version_major": 2, "version_minor": 0}
</script>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">timeout</span>                                   Traceback (most recent call last)
<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    420</span>                     <span class="ansi-red-fg"># Otherwise it looks like a bug in the code.</span>
<span class="ansi-green-fg">--&gt; 421</span><span class="ansi-red-fg">                     </span>six<span class="ansi-blue-fg">.</span>raise_from<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>         <span class="ansi-green-fg">except</span> <span class="ansi-blue-fg">(</span>SocketTimeout<span class="ansi-blue-fg">,</span> BaseSSLError<span class="ansi-blue-fg">,</span> SocketError<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/packages/six.py</span> in <span class="ansi-cyan-fg">raise_from</span><span class="ansi-blue-fg">(value, from_value)</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    415</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 416</span><span class="ansi-red-fg">                     </span>httplib_response <span class="ansi-blue-fg">=</span> conn<span class="ansi-blue-fg">.</span>getresponse<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    417</span>                 <span class="ansi-green-fg">except</span> BaseException <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.6.8/lib/python3.6/http/client.py</span> in <span class="ansi-cyan-fg">getresponse</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1330</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1331</span><span class="ansi-red-fg">                 </span>response<span class="ansi-blue-fg">.</span>begin<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1332</span>             <span class="ansi-green-fg">except</span> ConnectionError<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.6.8/lib/python3.6/http/client.py</span> in <span class="ansi-cyan-fg">begin</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    296</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 297</span><span class="ansi-red-fg">             </span>version<span class="ansi-blue-fg">,</span> status<span class="ansi-blue-fg">,</span> reason <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_read_status<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    298</span>             <span class="ansi-green-fg">if</span> status <span class="ansi-blue-fg">!=</span> CONTINUE<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.6.8/lib/python3.6/http/client.py</span> in <span class="ansi-cyan-fg">_read_status</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    257</span>     <span class="ansi-green-fg">def</span> _read_status<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 258</span><span class="ansi-red-fg">         </span>line <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fp<span class="ansi-blue-fg">.</span>readline<span class="ansi-blue-fg">(</span>_MAXLINE <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;iso-8859-1&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    259</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>line<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;</span> _MAXLINE<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.6.8/lib/python3.6/socket.py</span> in <span class="ansi-cyan-fg">readinto</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    585</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 586</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sock<span class="ansi-blue-fg">.</span>recv_into<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    587</span>             <span class="ansi-green-fg">except</span> timeout<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">timeout</span>: timed out

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ReadTimeoutError</span>                          Traceback (most recent call last)
<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/requests/adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    448</span>                     retries<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>max_retries<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 449</span><span class="ansi-red-fg">                     </span>timeout<span class="ansi-blue-fg">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">    450</span>                 )

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    719</span>             retries = retries.increment(
<span class="ansi-green-fg">--&gt; 720</span><span class="ansi-red-fg">                 </span>method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> error<span class="ansi-blue-fg">=</span>e<span class="ansi-blue-fg">,</span> _pool<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">,</span> _stacktrace<span class="ansi-blue-fg">=</span>sys<span class="ansi-blue-fg">.</span>exc_info<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    721</span>             )

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/util/retry.py</span> in <span class="ansi-cyan-fg">increment</span><span class="ansi-blue-fg">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="ansi-green-intense-fg ansi-bold">    399</span>             <span class="ansi-green-fg">if</span> read <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">False</span> <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>_is_method_retryable<span class="ansi-blue-fg">(</span>method<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 400</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> six<span class="ansi-blue-fg">.</span>reraise<span class="ansi-blue-fg">(</span>type<span class="ansi-blue-fg">(</span>error<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> error<span class="ansi-blue-fg">,</span> _stacktrace<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    401</span>             <span class="ansi-green-fg">elif</span> read <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/packages/six.py</span> in <span class="ansi-cyan-fg">reraise</span><span class="ansi-blue-fg">(tp, value, tb)</span>
<span class="ansi-green-intense-fg ansi-bold">    734</span>                 <span class="ansi-green-fg">raise</span> value<span class="ansi-blue-fg">.</span>with_traceback<span class="ansi-blue-fg">(</span>tb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 735</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> value
<span class="ansi-green-intense-fg ansi-bold">    736</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    671</span>                 headers<span class="ansi-blue-fg">=</span>headers<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 672</span><span class="ansi-red-fg">                 </span>chunked<span class="ansi-blue-fg">=</span>chunked<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    673</span>             )

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>         <span class="ansi-green-fg">except</span> <span class="ansi-blue-fg">(</span>SocketTimeout<span class="ansi-blue-fg">,</span> BaseSSLError<span class="ansi-blue-fg">,</span> SocketError<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 423</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_raise_timeout<span class="ansi-blue-fg">(</span>err<span class="ansi-blue-fg">=</span>e<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">=</span>url<span class="ansi-blue-fg">,</span> timeout_value<span class="ansi-blue-fg">=</span>read_timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    424</span>             <span class="ansi-green-fg">raise</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_raise_timeout</span><span class="ansi-blue-fg">(self, err, url, timeout_value)</span>
<span class="ansi-green-intense-fg ansi-bold">    330</span>             raise ReadTimeoutError(
<span class="ansi-green-fg">--&gt; 331</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;Read timed out. (read timeout=%s)&#34;</span> <span class="ansi-blue-fg">%</span> timeout_value
<span class="ansi-green-intense-fg ansi-bold">    332</span>             )

<span class="ansi-red-fg">ReadTimeoutError</span>: HTTPConnectionPool(host=&#39;localhost&#39;, port=8983): Read timed out. (read timeout=60)

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ReadTimeout</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/pysolr.py</span> in <span class="ansi-cyan-fg">_send_request</span><span class="ansi-blue-fg">(self, method, path, body, headers, files)</span>
<span class="ansi-green-intense-fg ansi-bold">    384</span>             resp = requests_method(url, data=bytes_body, headers=headers, files=files,
<span class="ansi-green-fg">--&gt; 385</span><span class="ansi-red-fg">                                    timeout=self.timeout, auth=self.auth)
</span><span class="ansi-green-intense-fg ansi-bold">    386</span>         <span class="ansi-green-fg">except</span> requests<span class="ansi-blue-fg">.</span>exceptions<span class="ansi-blue-fg">.</span>Timeout <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/requests/sessions.py</span> in <span class="ansi-cyan-fg">post</span><span class="ansi-blue-fg">(self, url, data, json, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    580</span> 
<span class="ansi-green-fg">--&gt; 581</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>request<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;POST&#39;</span><span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">=</span>data<span class="ansi-blue-fg">,</span> json<span class="ansi-blue-fg">=</span>json<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    582</span> 

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/requests/sessions.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    532</span>         send_kwargs<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>settings<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 533</span><span class="ansi-red-fg">         </span>resp <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>send<span class="ansi-blue-fg">(</span>prep<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>send_kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span> 

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/requests/sessions.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    645</span>         <span class="ansi-red-fg"># Send the request</span>
<span class="ansi-green-fg">--&gt; 646</span><span class="ansi-red-fg">         </span>r <span class="ansi-blue-fg">=</span> adapter<span class="ansi-blue-fg">.</span>send<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    647</span> 

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/requests/adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    528</span>             <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">,</span> ReadTimeoutError<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 529</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> ReadTimeout<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">,</span> request<span class="ansi-blue-fg">=</span>request<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">ReadTimeout</span>: HTTPConnectionPool(host=&#39;localhost&#39;, port=8983): Read timed out. (read timeout=60)

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">SolrError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-5fb60887ce6d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> model_df <span class="ansi-blue-fg">=</span> model_df<span class="ansi-blue-fg">.</span>head<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">20</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-green-fg">for</span> index<span class="ansi-blue-fg">,</span> row <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">.</span>tqdm_notebook<span class="ansi-blue-fg">(</span>model_df<span class="ansi-blue-fg">.</span>iterrows<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> total<span class="ansi-blue-fg">=</span>model_df<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg">     </span>result <span class="ansi-blue-fg">=</span> find_matches<span class="ansi-blue-fg">(</span>row<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> df <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>concat<span class="ansi-blue-fg">(</span>results<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-7-dd03a394198e&gt;</span> in <span class="ansi-cyan-fg">find_matches</span><span class="ansi-blue-fg">(target)</span>
<span class="ansi-green-intense-fg ansi-bold">     28</span> 
<span class="ansi-green-intense-fg ansi-bold">     29</span>     <span class="ansi-red-fg"># Delete the model legislation that we&#39;re done</span>
<span class="ansi-green-fg">---&gt; 30</span><span class="ansi-red-fg">     </span>solr<span class="ansi-blue-fg">.</span>delete<span class="ansi-blue-fg">(</span>q<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;bill_id:0&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     31</span> 
<span class="ansi-green-intense-fg ansi-bold">     32</span>     return pd.DataFrame({

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/pysolr.py</span> in <span class="ansi-cyan-fg">delete</span><span class="ansi-blue-fg">(self, id, q, commit, softCommit, waitFlush, waitSearcher, handler)</span>
<span class="ansi-green-intense-fg ansi-bold">    958</span>             m <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#39;&lt;delete&gt;&lt;query&gt;%s&lt;/query&gt;&lt;/delete&gt;&#39;</span> <span class="ansi-blue-fg">%</span> q
<span class="ansi-green-intense-fg ansi-bold">    959</span> 
<span class="ansi-green-fg">--&gt; 960</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_update<span class="ansi-blue-fg">(</span>m<span class="ansi-blue-fg">,</span> commit<span class="ansi-blue-fg">=</span>commit<span class="ansi-blue-fg">,</span> softCommit<span class="ansi-blue-fg">=</span>softCommit<span class="ansi-blue-fg">,</span> waitFlush<span class="ansi-blue-fg">=</span>waitFlush<span class="ansi-blue-fg">,</span> waitSearcher<span class="ansi-blue-fg">=</span>waitSearcher<span class="ansi-blue-fg">,</span> handler<span class="ansi-blue-fg">=</span>handler<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    961</span> 
<span class="ansi-green-intense-fg ansi-bold">    962</span>     <span class="ansi-green-fg">def</span> commit<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> softCommit<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> waitFlush<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> waitSearcher<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> expungeDeletes<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> handler<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;update&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/pysolr.py</span> in <span class="ansi-cyan-fg">_update</span><span class="ansi-blue-fg">(self, message, clean_ctrl_chars, commit, softCommit, waitFlush, waitSearcher, overwrite, handler)</span>
<span class="ansi-green-intense-fg ansi-bold">    498</span>             message <span class="ansi-blue-fg">=</span> sanitize<span class="ansi-blue-fg">(</span>message<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    499</span> 
<span class="ansi-green-fg">--&gt; 500</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_send_request<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;post&#39;</span><span class="ansi-blue-fg">,</span> path<span class="ansi-blue-fg">,</span> message<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#39;Content-type&#39;</span><span class="ansi-blue-fg">:</span> <span class="ansi-blue-fg">&#39;text/xml; charset=utf-8&#39;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    501</span> 
<span class="ansi-green-intense-fg ansi-bold">    502</span>     <span class="ansi-green-fg">def</span> _extract_error<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> resp<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/share/virtualenvs/algos-book-zMo2shYq/lib/python3.6/site-packages/pysolr.py</span> in <span class="ansi-cyan-fg">_send_request</span><span class="ansi-blue-fg">(self, method, path, body, headers, files)</span>
<span class="ansi-green-intense-fg ansi-bold">    387</span>             error_message <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;Connection to server &#39;%s&#39; timed out: %s&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    388</span>             self<span class="ansi-blue-fg">.</span>log<span class="ansi-blue-fg">.</span>error<span class="ansi-blue-fg">(</span>error_message<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">,</span> exc_info<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 389</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> SolrError<span class="ansi-blue-fg">(</span>error_message <span class="ansi-blue-fg">%</span> <span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    390</span>         <span class="ansi-green-fg">except</span> requests<span class="ansi-blue-fg">.</span>exceptions<span class="ansi-blue-fg">.</span>ConnectionError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    391</span>             error_message <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;Failed to connect to server at &#39;%s&#39;, are you sure that URL is correct? Checking it in a browser might help: %s&#34;</span>

<span class="ansi-red-fg">SolrError</span>: Connection to server &#39;http://localhost:8983/solr/legislation/update/?commit=true&#39; timed out: HTTPConnectionPool(host=&#39;localhost&#39;, port=8983): Read timed out. (read timeout=60)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;matches&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
 


    </div>
  </div>
</div>

<script>
  [...document.querySelectorAll(".code_cell")].filter(cell => cell.innerText.trim().length === 0).forEach(cell => cell.remove())
</script>

  <div class="footer bg-secondary">
  <div class="content">
    <div class="columns">
      <div class="column col-6 col-sm-12">
        <p><strong>Hi, welcome to Data Science for Journalism!</strong></p>
        <p>There's been a lot of buzz about machine learning and "artificial intelligence" being used in stories over
          the past few years. It's mostly not that complicated - a little stats, a classifier here or there - but it's
          hard to know where to start without a little help.</p>
        <p>Hopefully this site can be that help! <a href="/ds4j/about">Learn more about this project here.</a></p>
      </div>
      <div class="column col-3 col-sm-6">
        <p><strong>Quick links</strong></p>
        <!-- <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p> -->
      </div>
      <div class="column col-3 col-sm6">
        <p><strong>Contact</strong></p>
        <p><a href="mailto:hello@littlecolumns.com">hello@littlecolumns.com</a></p>
      </div>
    </div>
  </div>
</div>
  <script src="/ds4j/js/tocbot.js"></script>

  <script>
    try {
      let toc = document.createElement("div")
      toc.setAttribute('class', 'js-toc')
      document.querySelector(".reading-options").parentNode.appendChild(toc)
    } catch (err) {

    }

    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '.js-toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '.notebook',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3, h4',
      activeLinkClass: 'active',
      listClass: 'nav',
      listItemClass: 'nav-item',
      headingLabelCallback: function (label) {
        return label.replace("#", "")
      }
    });
  </script>

</body>

</html>
<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <title>02-Taking a million pieces of legislation from a CSV and inserting them into Postgres</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans:400,700&display=swap" rel="stylesheet"> -->
  <link rel="stylesheet" href="/ds4j/css/spectre.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-exp.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-icons.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/ds4j/css/style.css" rel="stylesheet">
  <link href="/ds4j/css/highlight.css" rel="stylesheet">
</head>

<body>
  <div class="nav-holder bg-secondary">
  <div class='content'>
    <header class="navbar">
      <section class="navbar-section">
        <a href="/ds4j/" class="navbar-brand mr-2">DS4J</a>
      </section>
      <section class="navbar-section">
        <a href="/ds4j/projects" class="btn btn-link">Projects</a>
        <a href="/ds4j/topics" class="btn btn-link">Topics</a>
        <a href="/ds4j/curriculum" class="btn btn-link">Curriculum</a>
        <a href="/ds4j/about" class="btn btn-link">About</a>
      </section>
    </header>
  </div>
</div>
  
<div class="content text-based">
  <div class="columns">
    <div class="column col-12 notebook">
      <ul class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Projects</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/azcentral-text-reuse-model-legislation/">Detecting special interest model legislation in state laws</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/azcentral-text-reuse-model-legislation/02-taking-a-million-pieces-of-legislation-from-a-csv-and-inserting-them-into-postgres">02-Taking a million pieces of legislation from a CSV and inserting them into Postgres</a>
        </li>
      </ul>

      <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Inserting-data-from-a-CSV-into-a-Postgres-database">Inserting data from a CSV into a Postgres database<a class="anchor-link" href="#Inserting-data-from-a-CSV-into-a-Postgres-database">#</a></h1><p>Our dataset of legislation information is a big big big CSV - over a million rows! To make it easier to manage later on - to process it in chunks, to query easily - it's probably best to move it into a database. We're going to use a Postgres database. On OS X an easy way to install Postgress is using <a href="https://postgresapp.com/">Postgres.app</a></p>
<h2 id="Read-in-our-data">Read in our data<a class="anchor-link" href="#Read-in-our-data">#</a></h2><p>We'll start by reading in our dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="reading-options">
  <a class="btn" href="/ds4j/azcentral-text-reuse-model-legislation/02-taking-a-million-pieces-of-legislation-from-a-csv-and-inserting-them-into-postgres">
    <i class="fa fa-sm fa-book"></i>
    Read online
  </a>
  <a class="btn" href="/ds4j/azcentral-text-reuse-model-legislation/notebooks/02-Taking a million pieces of legislation from a CSV and inserting them into Postgres.ipynb">
    <i class="fa fa-sm fa-download"></i>
    Download notebook
  </a>
  <a class="btn" href="#">
    <i class="fa fa-sm fa-laptop"></i>
    Interactive version
  </a>
</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/bills-with-urls.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1253402, 11)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bill_id</th>
      <th>code</th>
      <th>bill_number</th>
      <th>title</th>
      <th>description</th>
      <th>state</th>
      <th>session</th>
      <th>filename</th>
      <th>status</th>
      <th>status_date</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>325258</td>
      <td>HCR143</td>
      <td>HCR143</td>
      <td>House Concurrent Resolution Congratulating The...</td>
      <td>House Concurrent Resolution Congratulating The...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/HC...</td>
      <td>4</td>
      <td>2011-04-22</td>
      <td>http://www.leg.state.vt.us/docs/2012/Acts/ACTR...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285625</td>
      <td>H0291</td>
      <td>H0291</td>
      <td>An Act Relating To Raising The Penalties For A...</td>
      <td>An Act Relating To Raising The Penalties For A...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/H0...</td>
      <td>1</td>
      <td>2011-02-22</td>
      <td>http://www.leg.state.vt.us/docs/2012/bills/Int...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>398232</td>
      <td>S0162</td>
      <td>S0162</td>
      <td>An Act Relating To Powers Of Attorney</td>
      <td>An Act Relating To Powers Of Attorney</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/S0...</td>
      <td>1</td>
      <td>2012-01-03</td>
      <td>http://www.leg.state.vt.us/docs/2012/bills/Int...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>243054</td>
      <td>S0027</td>
      <td>S0027</td>
      <td>An Act Relating To The Role Of Municipalities ...</td>
      <td>An Act Relating To The Role Of Municipalities ...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/S0...</td>
      <td>1</td>
      <td>2011-01-25</td>
      <td>http://www.leg.state.vt.us/docs/2012/bills/Int...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>417691</td>
      <td>H0784</td>
      <td>H0784</td>
      <td>An Act Relating To Approval Of The Adoption An...</td>
      <td>An Act Relating To Approval Of The Adoption An...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/H0...</td>
      <td>4</td>
      <td>2012-05-05</td>
      <td>http://www.leg.state.vt.us/docs/2012/Acts/ACTM...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-our-database">Create our database<a class="anchor-link" href="#Create-our-database">#</a></h2><p>You could create the database by actually logging into postgres and running the commands below, but we'll do it by using the <code>sqlalchemy</code> and <code>psycopg2</code> packages.</p>
<p>Our database is going to be called <code>legislation</code>. Just in case it's already been created, we're going to forcibly delete it and then re-create it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost:5432/postgres&#39;</span><span class="p">,</span> <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># If anyone is connected to it, we&#39;ll need to kick them off.</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT pg_terminate_backend(pg_stat_activity.pid)</span>
<span class="s2">            FROM pg_stat_activity</span>
<span class="s2">            WHERE pg_stat_activity.datname = &#39;legislation&#39; AND pid &lt;&gt; pg_backend_pid();</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DROP DATABASE IF EXISTS legislation;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE DATABASE legislation;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll then connect to our database and create the table we'll be storing our bills in. If you need a reminder of what the fields were that we created:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bill_id</th>
      <td>325258</td>
    </tr>
    <tr>
      <th>code</th>
      <td>HCR143</td>
    </tr>
    <tr>
      <th>bill_number</th>
      <td>HCR143</td>
    </tr>
    <tr>
      <th>title</th>
      <td>House Concurrent Resolution Congratulating The...</td>
    </tr>
    <tr>
      <th>description</th>
      <td>House Concurrent Resolution Congratulating The...</td>
    </tr>
    <tr>
      <th>state</th>
      <td>VT</td>
    </tr>
    <tr>
      <th>session</th>
      <td>2011-2012 Session</td>
    </tr>
    <tr>
      <th>filename</th>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/HC...</td>
    </tr>
    <tr>
      <th>status</th>
      <td>4</td>
    </tr>
    <tr>
      <th>status_date</th>
      <td>2011-04-22</td>
    </tr>
    <tr>
      <th>url</th>
      <td>http://www.leg.state.vt.us/docs/2012/Acts/ACTR...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll also create fields to keep track of converting them to text:</p>
<ul>
<li>A <strong>content</strong> column to store the text of the bill</li>
<li>An <strong>error</strong> column to store a note about any errors we encountered processing the bill</li>
<li>A <strong>processed_at</strong> column to keep track of which ones have been attempted and which have not.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost:5432/legislation&#39;</span><span class="p">,</span> <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE TABLE public.bills (</span>
<span class="s2">            id serial NOT NULL,</span>
<span class="s2">            bill_id numeric NOT NULL,</span>
<span class="s2">            code text,</span>
<span class="s2">            bill_number text,</span>
<span class="s2">            title text,</span>
<span class="s2">            description text,</span>
<span class="s2">            state varchar(2),</span>
<span class="s2">            session text,</span>
<span class="s2">            filename text,</span>
<span class="s2">            status numeric,</span>
<span class="s2">            status_date TIMESTAMPTZ,   </span>
<span class="s2">            url text,</span>

<span class="s2">            content text,</span>
<span class="s2">            error text,</span>
<span class="s2">            processed_at TIMESTAMPTZ,</span>
<span class="s2">            PRIMARY KEY (&quot;id&quot;)</span>
<span class="s2">        );</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Insert-our-data-into-the-database">Insert our data into the database<a class="anchor-link" href="#Insert-our-data-into-the-database">#</a></h1><p>Now that we have our database created, we can insert them all into the database. We'll be using pandas' <code>to_sql</code> method. How many are we adding?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1253402, 11)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="...and-add-some-empty-columns">...and add some empty columns<a class="anchor-link" href="#...and-add-some-empty-columns">#</a></h2><p>We'll also specify some extra columns that we'll be using later like <strong>content</strong> and <strong>error</strong>. We need to make them blank first, then set the <code>dtype</code> when we save to the database so that postgres knows they're text columns.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;processed_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bill_id</th>
      <th>code</th>
      <th>bill_number</th>
      <th>title</th>
      <th>description</th>
      <th>state</th>
      <th>session</th>
      <th>filename</th>
      <th>status</th>
      <th>status_date</th>
      <th>url</th>
      <th>error</th>
      <th>content</th>
      <th>processed_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>325258</td>
      <td>HCR143</td>
      <td>HCR143</td>
      <td>House Concurrent Resolution Congratulating The...</td>
      <td>House Concurrent Resolution Congratulating The...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/HC...</td>
      <td>4</td>
      <td>2011-04-22</td>
      <td>http://www.leg.state.vt.us/docs/2012/Acts/ACTR...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285625</td>
      <td>H0291</td>
      <td>H0291</td>
      <td>An Act Relating To Raising The Penalties For A...</td>
      <td>An Act Relating To Raising The Penalties For A...</td>
      <td>VT</td>
      <td>2011-2012 Session</td>
      <td>bill_data/VT/2011-2012_Regular_Session/bill/H0...</td>
      <td>1</td>
      <td>2011-02-22</td>
      <td>http://www.leg.state.vt.us/docs/2012/bills/Int...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://localhost:5432/legislation&#39;</span><span class="p">,</span> <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;bills&#39;</span><span class="p">,</span>
          <span class="n">engine</span><span class="p">,</span>
          <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span>
          <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
          <span class="n">chunksize</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
          <span class="n">dtype</span><span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;bill_id&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">INTEGER</span><span class="p">(),</span> 
            <span class="s1">&#39;code&#39;</span><span class="p">:</span>  <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;bill_number&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">INTEGER</span><span class="p">(),</span>
            <span class="s1">&#39;status_date&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(),</span>
            <span class="s1">&#39;processed_at&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
          <span class="p">})</span>

<span class="c1"># Add indices to speed up processing</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE INDEX idx_bill_id ON bills (bill_id);</span>
<span class="s2">        CREATE INDEX idx_processed_at ON bills (processed_at);</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
 


    </div>
  </div>
</div>

<script>
  [...document.querySelectorAll(".code_cell")].filter(cell => cell.innerText.trim().length === 0).forEach(cell => cell.remove())
</script>

  <div class="footer bg-secondary">
  <div class="content">
    <div class="columns">
      <div class="column col-6 col-sm-12">
        <p><strong>Hi, welcome to Data Science for Journalism!</strong></p>
        <p>There's been a lot of buzz about machine learning and "artificial intelligence" being used in stories over
          the past few years. It's mostly not that complicated - a little stats, a classifier here or there - but it's
          hard to know where to start without a little help.</p>
        <p>Hopefully this site can be that help! <a href="/ds4j/about">Learn more about this project here.</a></p>
      </div>
      <div class="column col-3 col-sm-6">
        <p><strong>Quick links</strong></p>
        <!-- <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p> -->
      </div>
      <div class="column col-3 col-sm6">
        <p><strong>Contact</strong></p>
        <p><a href="mailto:hello@littlecolumns.com">hello@littlecolumns.com</a></p>
      </div>
    </div>
  </div>
</div>
  <script src="/ds4j/js/tocbot.js"></script>

  <script>
    try {
      let toc = document.createElement("div")
      toc.setAttribute('class', 'js-toc')
      document.querySelector(".reading-options").parentNode.appendChild(toc)
    } catch (err) {

    }

    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '.js-toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '.notebook',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3, h4',
      activeLinkClass: 'active',
      listClass: 'nav',
      listItemClass: 'nav-item',
      headingLabelCallback: function (label) {
        return label.replace("#", "")
      }
    });
  </script>

</body>

</html>
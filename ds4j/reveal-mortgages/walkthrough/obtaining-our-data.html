<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.4 Obtaining our data | _main.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="1.4 Obtaining our data | _main.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.4 Obtaining our data | _main.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="refining-our-question.html"/>
<link rel="next" href="working-with-our-data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1.1</b> Preface</a><ul>
<li class="chapter" data-level="1.1.1" data-path="preface.html"><a href="preface.html#the-original-story"><i class="fa fa-check"></i><b>1.1.1</b> The original story</a></li>
<li class="chapter" data-level="1.1.2" data-path="preface.html"><a href="preface.html#more-stuff-here"><i class="fa fa-check"></i><b>1.1.2</b> More stuff here?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="turning-our-question-into-measureables.html"><a href="turning-our-question-into-measureables.html"><i class="fa fa-check"></i><b>1.2</b> Turning our question into measureables</a><ul>
<li class="chapter" data-level="1.2.1" data-path="turning-our-question-into-measureables.html"><a href="turning-our-question-into-measureables.html#data-race"><i class="fa fa-check"></i><b>1.2.1</b> Data: Race</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="refining-our-question.html"><a href="refining-our-question.html"><i class="fa fa-check"></i><b>1.3</b> Refining our question</a></li>
<li class="chapter" data-level="1.4" data-path="obtaining-our-data.html"><a href="obtaining-our-data.html"><i class="fa fa-check"></i><b>1.4</b> Obtaining our data</a><ul>
<li class="chapter" data-level="1.4.1" data-path="obtaining-our-data.html"><a href="obtaining-our-data.html#downloading-hmda-data-science-kit"><i class="fa fa-check"></i><b>1.4.1</b> Downloading HMDA Data Science Kit</a></li>
<li class="chapter" data-level="1.4.2" data-path="obtaining-our-data.html"><a href="obtaining-our-data.html#importing-data-into-postgres"><i class="fa fa-check"></i><b>1.4.2</b> Importing data into Postgres</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="working-with-our-data.html"><a href="working-with-our-data.html"><i class="fa fa-check"></i><b>1.5</b> Working with our data</a><ul>
<li class="chapter" data-level="1.5.1" data-path="working-with-our-data.html"><a href="working-with-our-data.html#connecting-to-the-database"><i class="fa fa-check"></i><b>1.5.1</b> Connecting to the database</a></li>
<li class="chapter" data-level="1.5.2" data-path="working-with-our-data.html"><a href="working-with-our-data.html#understanding-our-data"><i class="fa fa-check"></i><b>1.5.2</b> Understanding our data</a></li>
<li class="chapter" data-level="1.5.3" data-path="working-with-our-data.html"><a href="working-with-our-data.html#following-the-whitepaper"><i class="fa fa-check"></i><b>1.5.3</b> Following the whitepaper</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="obtaining-our-data" class="section level2">
<h2><span class="header-section-number">1.4</span> Obtaining our data</h2>
<div id="downloading-hmda-data-science-kit" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Downloading HMDA Data Science Kit</h3>
<p>You can browse around and download the <a href="https://www.ffiec.gov/hmda/hmdaproducts.htm">actual files</a> from HMDA, but it’s kind of a complicated process, and not terribly simple if you need to cross multiple years.</p>
<p>Thankfully, the Consumer Finance Protection Bureau has done a great job producing software products to help HMDA data be analyzed (and analyzed well!). One of these products is the <a href="https://github.com/cfpb/HMDA_Data_Science_Kit">HMDA Data Science Kit</a>, which we’ll be using.</p>
<p>According to the README:</p>
<blockquote>
<p>The primary goal of this repository is to provide data users with tools to enable them to produce accurate analytics results. Additionally, this repository provides an overview of HMDA resources, publications, and guidelines for proper use. This repository does not provide statutory interpretation or compliance assistance.</p>
</blockquote>
<p>They’re missing out on the most important part: it has a bunch of scripts that help you <strong>download the data and process it into a Postgres database!</strong></p>
<p>Why Postgres and not Excel or a CSV file? It’s a lot of data. A lot lot lot lot lot of data. Many, many, many gigs of data, especially if we’re dealing with more recent years or data across multiple years.</p>
<p>We aren’t going to have a good time if we’re trying to deal with it via the typical CSV+pandas setup — we’d either need a lot of RAM in our machine, to use something in the cloud, or work with a fancier setup that is able to chunk in large datasets to pandas.</p>
<p>Postgres is the perfect solution, as it allows us to segment our data into useful pieces quickly and easily, and take summary statistics without too much work.</p>
<p>To download HMDA Data Science Kit, you can either click <a href="https://github.com/cfpb/HMDA_Data_Science_Kit/archive/master.zip">this link</a> or download it from <a href="https://github.com/cfpb/HMDA_Data_Science_Kit">their GitHub Repo</a>.</p>
</div>
<div id="importing-data-into-postgres" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Importing data into Postgres</h3>
<p>According to <a href="https://www.revealnews.org/article/how-we-identified-lending-disparities-in-federal-mortgage-data/">Reveal’s writeup</a>, “Reveal separately analyzed data from 2015 and 2016.” We’ll just stick with 2015 to keep things a bit simpler.</p>
<p>The HMDA Data Science README has <a href="https://github.com/cfpb/HMDA_Data_Science_Kit#basic-requirements-and-instructions">a section on downloading and importing the data</a>, but I’ve simplified the instructions for you below.</p>
<blockquote>
<p>TODO SOMETHING ABOUT INSTALLING POSTGRES</p>
</blockquote>
<p>First, we’ll unzip <code>HMDA_Data_Science_Kit-master.zip</code> into a new folder. There is a <em>lot</em> of stuff in there, but we’re only interested in a few scripts that download datasets and import them into a database.</p>
<p>The first cript will download the 2015 LAR HMDA data:</p>
<pre><code>bash download_scripts/download_hmda.sh -Fs lar_2015</code></pre>
<p>This next command extracts the data from the zip files and renames them to a standardized format. We only have one LAR file, but that’s fine! This one will take forever. Like, forever forever.</p>
<pre><code>bash download_scripts/unzip_and_rename_lar.sh</code></pre>
<p>You’ll receive a handful of error messages — you’re missing the other years, after all — but as long as it hung around on <code>inflating:</code> for a long long time you’ll be all set.</p>
<p>Now we need to get started with our database. First we’ll create the standardized database…</p>
<pre><code>bash load_scripts/create_hmda_db.sh</code></pre>
<p>…then we’ll load in our data. Even though this command looks like it’s going to load in thirteen years of data, since we only have LAR data fro 2015 that’s all that will be imported into Postgres.</p>
<pre><code>bash load_scripts/create_and_load_lar_2004_2017.sh</code></pre>
<p>Again, it’s a lot of data, so it’ll sit at <code>CREATE TABLE</code> for a long long time while it shovels it out of the CSV and into our database.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="refining-our-question.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-our-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>

<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <title>Counting words with scikit-learn&#39;s CountVectorizer</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans:400,700&display=swap" rel="stylesheet"> -->
  <link rel="stylesheet" href="/ds4j/css/spectre.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-exp.min.css">
  <link rel="stylesheet" href="/ds4j/css/spectre-icons.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/ds4j/css/style.css" rel="stylesheet">
  <link href="/ds4j/css/highlight.css" rel="stylesheet">
</head>

<body>
  <div class="nav-holder bg-secondary">
  <div class='content'>
    <header class="navbar">
      <section class="navbar-section">
        <a href="/ds4j/" class="navbar-brand mr-2">DS4J</a>
      </section>
      <section class="navbar-section">
        <a href="/ds4j/projects" class="btn btn-link">Projects</a>
        <a href="/ds4j/topics" class="btn btn-link">Topics</a>
        <a href="/ds4j/curriculum" class="btn btn-link">Curriculum</a>
        <a href="/ds4j/about" class="btn btn-link">About</a>
      </section>
    </header>
  </div>
</div>
  
<div class="content text-based">
  <div class="columns">
    <div class="column col-12 notebook">
      <ul class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#">Projects</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/basic-ml-concepts/">Short summaries and walkthroughs of basic concepts</a>
        </li>
        <li class="breadcrumb-item">
          <a href="/ds4j/basic-ml-concepts/counting-words-with-scikit-learns-countvectorizer">Counting words with scikit-learn&#39;s CountVectorizer</a>
        </li>
      </ul>

      <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Counting-words-in-Python-with-sklearn's-CountVectorizer">Counting words in Python with sklearn's CountVectorizer<a class="anchor-link" href="#Counting-words-in-Python-with-sklearn's-CountVectorizer">#</a></h1><p>There are several ways to count words in Python: the easiest is probably to use a <a href="https://pymotw.com/3/collections/counter.html">Counter</a>! We'll be covering another technique here, the CountVectorizer from <a href="https://scikit-learn.org/">scikit-learn</a>.</p>
<p>It's a little more intense than using Counter, but don't let that frighten you off! If your project is more complicated than "count the words in this book," the CountVectorizer might actually be easier in the long run.</p>
<p>While Counter is used for counting all sorts of things, the CountVectorizer is specifically used for <strong>counting words.</strong> The <strong>vectorizer</strong> part of CountVectorizer is (technically speaking!) the process of converting text into some sort of number-y thing that computers can understand.</p>
<p>Unfortunately, the "number-y thing that computers can understand" is kind of hard for us to understand. See below:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="reading-options">
  <a class="btn" href="/ds4j/basic-ml-concepts/counting-words-with-scikit-learns-countvectorizer">
    <i class="fa fa-sm fa-book"></i>
    Read online
  </a>
  <a class="btn" href="/ds4j/basic-ml-concepts/notebooks/Counting words with scikit-learn&#39;s CountVectorizer.ipynb">
    <i class="fa fa-sm fa-download"></i>
    Download notebook
  </a>
  <a class="btn" href="#">
    <i class="fa fa-sm fa-laptop"></i>
    Interactive version
  </a>
</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># Build our text</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Yesterday I went fishing. I don&#39;t fish that often, </span>
<span class="s2">so I didn&#39;t catch any fish. I was told I&#39;d enjoy myself, </span>
<span class="s2">but it didn&#39;t really seem that fun.&quot;&quot;&quot;</span>

<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
<span class="n">matrix</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;1x20 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
	with 20 stored elements in Compressed Sparse Row format&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to do a little magic to turn it into a format we can understand.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span>
                      <span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="n">counts</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>any</th>
      <th>but</th>
      <th>catch</th>
      <th>didn</th>
      <th>don</th>
      <th>enjoy</th>
      <th>fish</th>
      <th>fishing</th>
      <th>fun</th>
      <th>it</th>
      <th>myself</th>
      <th>often</th>
      <th>really</th>
      <th>seem</th>
      <th>so</th>
      <th>that</th>
      <th>told</th>
      <th>was</th>
      <th>went</th>
      <th>yesterday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="What-just-happened?">What just happened?<a class="anchor-link" href="#What-just-happened?">#</a></h1><p>Let's break it down line by line.</p>
<p>First, we made a new CountVectorizer. This is the thing that's going to understand and count the words for us. It has a <em>lot</em> of different options, but we'll just use the normal, standard version for now.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we told the vectorizer to read the text for us.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
<span class="n">matrix</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;1x20 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
	with 20 stored elements in Compressed Sparse Row format&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that we gave it <code>[text]</code> instead of just <code>text</code>. This is because sklearn is typically meant for the world of MACHINE LEARNING, where you're probably reading a lot of documents at once. Sklearn doesn't even want to deal with texts one at a time, so we have to send it a list.</p>
<p>When we did <code>.fit_transform()</code>, this did two things:</p>
<ol>
<li>Found all of the different words in the text</li>
<li>Counted how many of each there were</li>
</ol>
<p>The <code>matrix</code> variable it sent back is a big ugly thing just for computers. If we want to look at it, though, we can!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each of those numbers is how many times a word showed up - most words showed up one time, and some showed up twice. But how do we know which word is which?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;any&#39;, &#39;but&#39;, &#39;catch&#39;, &#39;didn&#39;, &#39;don&#39;, &#39;enjoy&#39;, &#39;fish&#39;, &#39;fishing&#39;, &#39;fun&#39;, &#39;it&#39;, &#39;myself&#39;, &#39;often&#39;, &#39;really&#39;, &#39;seem&#39;, &#39;so&#39;, &#39;that&#39;, &#39;told&#39;, &#39;was&#39;, &#39;went&#39;, &#39;yesterday&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The order of the words matches the order of the numbers! First in the words list is <code>any</code>, and first in the numbers list is <code>1</code>. That means "any" showed up once. In the same way you can figure out that <code>fish</code> is the seventh word in the list, which (count to the seventh number) showed up <code>2</code> times.</p>
<p>It gets easier if we move it into a pandas dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span>
                      <span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="n">counts</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>any</th>
      <th>but</th>
      <th>catch</th>
      <th>didn</th>
      <th>don</th>
      <th>enjoy</th>
      <th>fish</th>
      <th>fishing</th>
      <th>fun</th>
      <th>it</th>
      <th>myself</th>
      <th>often</th>
      <th>really</th>
      <th>seem</th>
      <th>so</th>
      <th>that</th>
      <th>told</th>
      <th>was</th>
      <th>went</th>
      <th>yesterday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There's <strong>something a little weird about this.</strong> <code>didn</code> isn't a word - it should be <code>didn't</code>, right? And <code>i</code> isn't in our list, even though the first sentence is "I went fishing yesterday." The reasons why:</p>
<ul>
<li>By default, the CountVectorizer splits words on punctuation, so <code>didn't</code> becomes two words - <code>didn</code> and <code>t</code>. Their argument is that it's <a href="https://github.com/nltk/nltk/issues/401">actually "did not"</a> and shouldn't be kept together. You can read more about this <a href="http://www.nltk.org/book/ch03.html#sec-tokenization">right here</a>.</li>
<li>By default, the CountVectorizer also <strong>only uses words that are 2 or more letters.</strong> So <code>i</code> doesn't make the cute, nor does the <code>t</code> up above.</li>
</ul>
<p>We don't have a good solution to the first one, but we can customize CountVectorizer to include 1-character words.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">token_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?u)\b\w+\b&quot;</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span>
                      <span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="n">counts</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>i</th>
      <td>5</td>
    </tr>
    <tr>
      <th>t</th>
      <td>3</td>
    </tr>
    <tr>
      <th>didn</th>
      <td>2</td>
    </tr>
    <tr>
      <th>that</th>
      <td>2</td>
    </tr>
    <tr>
      <th>fish</th>
      <td>2</td>
    </tr>
    <tr>
      <th>any</th>
      <td>1</td>
    </tr>
    <tr>
      <th>often</th>
      <td>1</td>
    </tr>
    <tr>
      <th>went</th>
      <td>1</td>
    </tr>
    <tr>
      <th>was</th>
      <td>1</td>
    </tr>
    <tr>
      <th>told</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Counting-words-in-a-book">Counting words in a book<a class="anchor-link" href="#Counting-words-in-a-book">#</a></h2><p>Now that we know the basics of how to clean text and do text analysis with <code>CountVectorizer</code>, let's try it with an actual book! We'll use Jane Austen's <a href="http://www.gutenberg.org/cache/epub/42671/pg42671.txt">Pride and Prejudice</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.gutenberg.org/cache/epub/42671/pg42671.txt&#39;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">4100</span><span class="p">:</span><span class="mi">4500</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>d to be any thing extraordinary now. When a woman has
five grown up daughters, she ought to give over thinking of her own
beauty.&#34;

&#34;In such cases, a woman has not often much beauty to think of.&#34;

&#34;But, my dear, you must indeed go and see Mr. Bingley when he comes into
the neighbourhood.&#34;

&#34;It is more than I engage for, I assure you.&#34;

&#34;But consider your daughters. Only think what an es
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">token_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?u)\b\w+\b&quot;</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span>
                      <span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="n">counts</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>the</th>
      <td>4520</td>
    </tr>
    <tr>
      <th>to</th>
      <td>4242</td>
    </tr>
    <tr>
      <th>of</th>
      <td>3749</td>
    </tr>
    <tr>
      <th>and</th>
      <td>3662</td>
    </tr>
    <tr>
      <th>her</th>
      <td>2205</td>
    </tr>
    <tr>
      <th>i</th>
      <td>2054</td>
    </tr>
    <tr>
      <th>a</th>
      <td>2003</td>
    </tr>
    <tr>
      <th>in</th>
      <td>1941</td>
    </tr>
    <tr>
      <th>was</th>
      <td>1846</td>
    </tr>
    <tr>
      <th>she</th>
      <td>1689</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Counting-words-in-multiple-books">Counting words in multiple books<a class="anchor-link" href="#Counting-words-in-multiple-books">#</a></h2><p>Remember how i said CountVectorizer is better at multiple pieces of text? Let's use that ability! We'll use a few:</p>
<ul>
<li><a href="http://www.gutenberg.org/cache/epub/42671/pg42671.txt">Pride and Prejudice</a></li>
<li><a href="https://www.gutenberg.org/files/84/84-0.txt">Frankenstein</a></li>
<li><a href="https://www.gutenberg.org/files/43/43-0.txt">Dr. Jekyll and Mr. Hyde</a></li>
<li><a href="https://www.gutenberg.org/files/1400/1400-0.txt">Great Expectations</a></li>
</ul>
<p>We'll create a dataframe out of the name and URL, then grab the contents of the books from the URL.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pride and Prejudice&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gutenberg.org/cache/epub/42671/pg42671.txt&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Frankenstein&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.gutenberg.org/files/84/84-0.txt&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Dr. Jekyll and Mr. Hyde&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.gutenberg.org/files/43/43-0.txt&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Great Expectations&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.gutenberg.org/files/1400/1400-0.txt&#39;</span> <span class="p">},</span>
<span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>url</th>
      <th>content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Pride and Prejudice</td>
      <td>http://www.gutenberg.org/cache/epub/42671/pg42...</td>
      <td>﻿The Project Gutenberg eBook, Pride and Prejud...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Frankenstein</td>
      <td>https://www.gutenberg.org/files/84/84-0.txt</td>
      <td>ï»¿\r\nProject Gutenberg's Frankenstein, by Ma...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dr. Jekyll and Mr. Hyde</td>
      <td>https://www.gutenberg.org/files/43/43-0.txt</td>
      <td>\r\nThe Project Gutenberg EBook of The Strange...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Great Expectations</td>
      <td>https://www.gutenberg.org/files/1400/1400-0.txt</td>
      <td>ï»¿The Project Gutenberg EBook of Great Expect...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we just feed it to the CountVectorizer, and we get a nice organized dataframe of the words counted in each book!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">token_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?u)\b\w+\b&quot;</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span>
                  <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                  <span class="n">columns</span><span class="o">=</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
<span class="n">counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>000</th>
      <th>1</th>
      <th>10</th>
      <th>10_th</th>
      <th>11</th>
      <th>11th</th>
      <th>12</th>
      <th>12th</th>
      <th>13</th>
      <th>...</th>
      <th>youths</th>
      <th>youâ</th>
      <th>z</th>
      <th>zeal</th>
      <th>zealous</th>
      <th>zest</th>
      <th>zip</th>
      <th>à</th>
      <th>â</th>
      <th>ï</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pride and Prejudice</th>
      <td>0</td>
      <td>1</td>
      <td>47</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Frankenstein</th>
      <td>2</td>
      <td>1</td>
      <td>49</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>869</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Dr. Jekyll and Mr. Hyde</th>
      <td>2</td>
      <td>1</td>
      <td>45</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>893</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Great Expectations</th>
      <td>3</td>
      <td>1</td>
      <td>47</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>7831</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 16220 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can even use it to select a interesting words out of each!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">counts</span><span class="p">[[</span><span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="s1">&#39;hate&#39;</span><span class="p">,</span> <span class="s1">&#39;murder&#39;</span><span class="p">,</span> <span class="s1">&#39;terror&#39;</span><span class="p">,</span> <span class="s1">&#39;cried&#39;</span><span class="p">,</span> <span class="s1">&#39;food&#39;</span><span class="p">,</span> <span class="s1">&#39;dead&#39;</span><span class="p">,</span> <span class="s1">&#39;sister&#39;</span><span class="p">,</span> <span class="s1">&#39;husband&#39;</span><span class="p">,</span> <span class="s1">&#39;wife&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>love</th>
      <th>hate</th>
      <th>murder</th>
      <th>terror</th>
      <th>cried</th>
      <th>food</th>
      <th>dead</th>
      <th>sister</th>
      <th>husband</th>
      <th>wife</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pride and Prejudice</th>
      <td>92</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>91</td>
      <td>0</td>
      <td>5</td>
      <td>217</td>
      <td>50</td>
      <td>47</td>
    </tr>
    <tr>
      <th>Frankenstein</th>
      <td>59</td>
      <td>9</td>
      <td>21</td>
      <td>10</td>
      <td>15</td>
      <td>27</td>
      <td>23</td>
      <td>26</td>
      <td>2</td>
      <td>11</td>
    </tr>
    <tr>
      <th>Dr. Jekyll and Mr. Hyde</th>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>12</td>
      <td>11</td>
      <td>0</td>
      <td>13</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Great Expectations</th>
      <td>60</td>
      <td>4</td>
      <td>20</td>
      <td>28</td>
      <td>60</td>
      <td>8</td>
      <td>49</td>
      <td>170</td>
      <td>16</td>
      <td>27</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Although though Python's <strong>Counter</strong> might be easier in situations where we're just looking at one piece of text and have time to clean it up, if you're looking to do more heavy lifting (including machine learning!) you'll want to turn to scikit-learn's vectorizers.</p>
<p>While we talked at length about CountVectorizer here, TfidfVectorizer is another common one that will take into account how often a word is used, and whether your texts are book-long or tweet-short.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
 


    </div>
  </div>
</div>

<script>
  [...document.querySelectorAll(".code_cell")].filter(cell => cell.innerText.trim().length === 0).forEach(cell => cell.remove())
</script>

  <div class="footer bg-secondary">
  <div class="content">
    <div class="columns">
      <div class="column col-6 col-sm-12">
        <p><strong>Hi, welcome to Data Science for Journalism!</strong></p>
        <p>There's been a lot of buzz about machine learning and "artificial intelligence" being used in stories over
          the past few years. It's mostly not that complicated - a little stats, a classifier here or there - but it's
          hard to know where to start without a little help.</p>
        <p>Hopefully this site can be that help! <a href="/ds4j/about">Learn more about this project here.</a></p>
      </div>
      <div class="column col-3 col-sm-6">
        <p><strong>Quick links</strong></p>
        <!-- <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p>
        <p><a href="#">Something here</a></p> -->
      </div>
      <div class="column col-3 col-sm6">
        <p><strong>Contact</strong></p>
        <p><a href="mailto:hello@littlecolumns.com">hello@littlecolumns.com</a></p>
      </div>
    </div>
  </div>
</div>
  <script src="/ds4j/js/tocbot.js"></script>

  <script>
    try {
      let toc = document.createElement("div")
      toc.setAttribute('class', 'js-toc')
      document.querySelector(".reading-options").parentNode.appendChild(toc)
    } catch (err) {

    }

    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '.js-toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '.notebook',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3, h4',
      activeLinkClass: 'active',
      listClass: 'nav',
      listItemClass: 'nav-item',
      headingLabelCallback: function (label) {
        return label.replace("#", "")
      }
    });
  </script>

</body>

</html>